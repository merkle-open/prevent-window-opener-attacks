{"version":3,"file":"auto.min.js","sources":["../src/lib.js","../src/index.js"],"sourcesContent":["\"use strict\";\r\nfunction preventWindowOpenerAttacks(clickEvent) {\r\n  document.documentElement.removeEventListener(\r\n    \"click\",\r\n    preventWindowOpenerAttacks\r\n  );\r\n  // Stop if any other javascript prevented the event\r\n  if (clickEvent.defaultPrevented) {\r\n    return;\r\n  }\r\n  // Stop if the clicked element is not an \"A\" element\r\n  if (!clickEvent.target || clickEvent.target.nodeName !== \"A\") {\r\n    return;\r\n  }\r\n  // Stop if the clicked a element is not set to target = _blank\r\n  if (clickEvent.target.target !== \"_blank\") {\r\n    return;\r\n  }\r\n\r\n  clickEvent.preventDefault();\r\n  var win = window.open(clickEvent.target.href, \"_blank\");\r\n  if (win) {\r\n    win.opener = null;\r\n  }\r\n}\r\n\r\nexport function startProtection(whiteList) {\r\n  // Add event listener to documentElement just before it bubbles up\r\n  document.body.addEventListener(\"click\", function(e) {\r\n    // Ensure that previous events are cleaned up even if the event did not bubble\r\n    document.documentElement.removeEventListener(\r\n      \"click\",\r\n      preventWindowOpenerAttacks\r\n    );\r\n    // Wait for the current event to bubble to the documentElement\r\n    document.documentElement.addEventListener(\r\n      \"click\",\r\n      preventWindowOpenerAttacks\r\n    );\r\n  });\r\n}\r\n\r\nexport function patchWindowOpen() {\r\n  var originalWindowOpen = window.open;\r\n  window.open = function(url, target) {\r\n    var result = originalWindowOpen.apply(this, arguments);\r\n    if (result && target === \"_blank\") {\r\n      result.opener = null;\r\n    }\r\n    return result;\r\n  };\r\n}\r\n","import { startProtection, patchWindowOpen } from \"./lib\";\r\n\r\n// Execute callback as soon as dom is ready\r\nfunction onReady(callback) {\r\n  if (document.readyState === \"loading\") {\r\n    document.addEventListener(\"DOMContentLoaded\", callback);\r\n  } else {\r\n    callback();\r\n  }\r\n}\r\n\r\n// Apply patches to work around javascript window.open vulnarabilities\r\npatchWindowOpen();\r\n\r\n// Wait until document body exists\r\n// and start click protection\r\nonReady(startProtection);\r\n"],"names":["preventWindowOpenerAttacks","clickEvent","document","documentElement","removeEventListener","defaultPrevented","target","nodeName","preventDefault","win","window","open","href","opener","originalWindowOpen","callback","url","result","apply","this","arguments","whiteList","body","addEventListener","e","readyState"],"mappings":"yBACA,SAASA,EAA2BC,GAMlC,GALAC,SAASC,gBAAgBC,oBACvB,QACAJ,IAGEC,EAAWI,kBAIVJ,EAAWK,QAAyC,MAA/BL,EAAWK,OAAOC,UAIX,WAA7BN,EAAWK,OAAOA,OAAtB,CAIAL,EAAWO,iBACX,IAAIC,EAAMC,OAAOC,KAAKV,EAAWK,OAAOM,KAAM,UAC1CH,IACFA,EAAII,OAAS,OAoBV,IACDC,ECxCWC,EDwCXD,EAAqBJ,OAAOC,KAChCD,OAAOC,KAAO,SAASK,EAAKV,GAC1B,IAAIW,EAASH,EAAmBI,MAAMC,KAAMC,WAI5C,OAHIH,GAAqB,WAAXX,IACZW,EAAOJ,OAAS,MAEXI,GC9CMF,EDuBV,SAAyBM,GAE9BnB,SAASoB,KAAKC,iBAAiB,QAAS,SAASC,GAE/CtB,SAASC,gBAAgBC,oBACvB,QACAJ,GAGFE,SAASC,gBAAgBoB,iBACvB,QACAvB,MCjCwB,YAAxBE,SAASuB,WACXvB,SAASqB,iBAAiB,mBAAoBR,GAE9CA"}